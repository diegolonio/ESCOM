/*
 * Apolonio Villegas Diego Armando
 * Palacios Cabrera Alberto
 * 
 * Proyecto final
 *
 */
    .DEF TEMP = R16
	.DEF SALTO = R17
	.DEF CONT1 = R18
	.DEF CONT2 = R19
	.DEF CONT3 = R20

	.CSEG

	.ORG 0
	RJMP RESET
	
	.ORG $024
	RJMP RX	

RESET:
	; Configuración de Pines
	; Pin D0 corresponde a RX, por lo tanto es entrada
	LDI	TEMP, $FE
	OUT DDRD, TEMP
	LDI	TEMP, $FF
	OUT DDRC, TEMP
	LDI	TEMP, $FF
	OUT DDRB, TEMP

	LDI TEMP, $00
	OUT PORTB, TEMP

	// Configuración de la USART

	LDI	TEMP, $98
	STS	UCSR0B, TEMP

	LDI	TEMP, 103
	STS	UBRR0L, TEMP

	SEI

MAIN:
	LDI	TEMP, $00
	OUT PORTC, TEMP
	JMP MAIN

RX:
	LDS TEMP, UDR0
	// Comando 'a'
	CPI TEMP, $61
	BREQ MOVIMIENTO_ADELANTE
	// Comando 'b'
	CPI TEMP, $62
	BREQ MOVIMIENTO_ATRAS
	// Comando 'c'
	CPI TEMP, $63
	BREQ MOVIMIENTO_IZQUIERDA
	// Comando 'd'
	CPI TEMP, $64
	BREQ MOVIMIENTO_DERECHA
	// Comando 'e'
	CPI TEMP, $65
	BREQ VUELTA_IZQUIERDA
	// Comando 'f'
	CPI TEMP, $66
	BREQ VUELTA_DERECHA
	// Comando 'g'
	CPI TEMP, $67
	BREQ LUCES
	// Comando 'h'
	CPI TEMP, $68
	BREQ AUMENTAR_VELOCIDAD
	// Comando 'i'
	CPI TEMP, $69
	BREQ DISMINUIR_VELOCIDAD
	RETI

// Movimientos

MOVIMIENTO_ADELANTE:
	LDI	TEMP, $05
	OUT PORTC, TEMP
	CALL DELAY_100M
	RETI

MOVIMIENTO_ATRAS:
	LDI	TEMP, $0A
	OUT PORTC, TEMP
	CALL DELAY_100M
	RETI

MOVIMIENTO_IZQUIERDA:
	LDI	TEMP, $04
	OUT PORTC, TEMP
	CALL DELAY_100M
	RETI

MOVIMIENTO_DERECHA:
	LDI	TEMP, $01
	OUT PORTC, TEMP
	CALL DELAY_100M
	RETI

VUELTA_IZQUIERDA:
	LDI	TEMP, $09
	OUT PORTC, TEMP
	CALL DELAY_100M
	RETI

VUELTA_DERECHA:
	LDI	TEMP, $06
	OUT PORTC, TEMP
	CALL DELAY_100M
	RETI
